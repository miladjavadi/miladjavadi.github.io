<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>box2kit Demonstration</title>
 <style>
body {
  font-family: sans-serif;
  margin: 2em;
}

/* Main 3-column grid, bottom aligned */
.columns {
  display: grid;
  grid-template-columns: repeat(3, 1fr);
  gap: 2em;
  align-items: end; /* bottom-align all columns */
}

/* General column styling */
.column {
  display: flex;
  flex-direction: column;
  justify-content: flex-end;
  gap: 1em;
}

/* Boxes for audio players (and dynamic players) */
.audio-box {
  background: #f9f9f9;
  padding: 1em;
  border-radius: 8px;
  box-shadow: 0 2px 4px rgba(0,0,0,0.1);
  display: flex;
  flex-direction: column;
}

/* Box header */
.audio-box h3 {
  margin-top: 0;
  text-align: left;
}

/* Grid inside box for 4 players */
.audio-grid {
  display: grid;
  grid-template-rows: repeat(4, auto);
  gap: 1em;
  margin-top: 0.5em;
}

/* Individual player */
.audio-player {
  margin: 0;
}

.audio-title {
  font-weight: bold;
  font-size: 0.9em;
  margin-bottom: 0.25em;
}

/* Controls above dynamic players */
.controls {
  background: #f9f9f9;
  padding: 0.5em 1em;
  border-radius: 8px;
  box-shadow: 0 2px 4px rgba(0,0,0,0.05);
  margin-bottom: 0.5em;
}

label, select, p {
  font-size: 0.9em;
  margin-bottom: 0.25em;
}

.checkbox-group, .radio-group {
  margin-bottom: 0.5em;
}

.radio-group label, .checkbox-group label {
  margin-right: 1em;
}
</style>

<header>
    <h1>box2kit</h1>
    <h2>A demonstration of </h2>
</header>

<div class="columns">
  <!-- Column 1: Static A -->
  <div class="column">
    <div class="audio-box">
      <h3>Output Audio (Acoustic Drums)</h3>
      <div class="audio-grid">
        <div class="audio-player"><p class="audio-title">Example 1</p><audio controls><source src="audio/output/1.mp3"></audio></div>
        <div class="audio-player"><p class="audio-title">Example 2</p><audio controls><source src="audio/output/2.mp3"></audio></div>
        <div class="audio-player"><p class="audio-title">Example 3</p><audio controls><source src="audio/output/3.mp3"></audio></div>
        <div class="audio-player"><p class="audio-title">Example 4</p><audio controls><source src="audio/output/4.mp3"></audio></div>
      </div>
    </div>
  </div>

  <!-- Column 2: Static B -->
  <div class="column">
    <div class="audio-box">
      <h3>Target Audio (Beatbox)</h3>
      <div class="audio-grid">
        <div class="audio-player"><p class="audio-title">Example 1</p><audio controls><source src="audio/target/1.mp3"></audio></div>
        <div class="audio-player"><p class="audio-title">Example 2</p><audio controls><source src="audio/target/2.mp3"></audio></div>
        <div class="audio-player"><p class="audio-title">Example 3</p><audio controls><source src="audio/target/3.mp3"></audio></div>
        <div class="audio-player"><p class="audio-title">Example 4</p><audio controls><source src="audio/target/4.mp3"></audio></div>
      </div>
    </div>
  </div>

  <!-- Column 3: Dynamic -->
  <div class="column">
    <!-- Controls box -->
    <div class="controls">
      <label for="category">Model type:</label>
      <select id="category">
        <option disabled selected>Select model type</option>
      </select>
      <div id="options-container"></div>
    </div>

    <!-- Dynamic players box -->
    <div class="audio-box">
      <h3>Generated Output</h3>
      <div class="audio-grid" id="player"></div>
    </div>
  </div>
</div>

<template id="audio-template">
  <div class="audio-player">
    <p class="audio-title"></p>
    <audio controls>
      <source src="" type="audio/mpeg">
      Your browser does not support the audio element.
    </audio>
  </div>
</template>


  <script>
    const categories = {
      "Affine": {
        options: [
          { type: "checkbox", label: "Requantize", id: "requantize" }
        ],
        getFiles: opts => {
          const base = "./audio/gen/affine/affine";
          const variant = opts.requantize ? "_requantized" : "";
          return [
            `${base}${variant}_1.mp3`,
            `${base}${variant}_2.mp3`,
            `${base}${variant}_3.mp3`,
            `${base}${variant}_4.mp3`
          ];
        }
      },
      "Match Search": {
        options: [
          { type: "radio-group", label: "Order", id: "order", values: [1, 3, 5] }
        ],
        getFiles: opts => {
          const base = `./audio/gen/match/order${opts.order}`;
          return [`${base}_1.mp3`, `${base}_2.mp3`, `${base}_3.mp3`, `${base}_4.mp3`];
        }
      },
      "Neural": {
        options: [
          { type: "checkbox", label: "Requantize", id: "requantize" },
          { type: "checkbox", label: "GAN", id: "gan" }
        ],
        getFiles: opts => {
          let base = "./audio/gen/neural/";
          if (opts.requantize) base += "_requantized";
          if (opts.gan) base += "_gan";
          return [`${base}_1.mp3`, `${base}_2.mp3`, `${base}_3.mp3`, `${base}_4.mp3`];
        }
      },
      "Waveform encoder (baseline)": {
        options: [
            { type: "radio-group", label: "Prior", id: "prior", values: ["MOG1", "MOG8"] },
            { type: "radio-group", label: "Objective", id: "objective", values: ["Self-approx.", "Transformative"] },
            { type: "checkbox", label: "GAN", id: "gan", default: false } // <-- set default
        ],
        getFiles: opts => {
            // ensure opts.gan is boolean
            const gan = opts.gan || false;
            let base = `./audio/gen/waveform/${opts.prior}_${opts.objective.replace(/\W+/g, "")}`;
            if (gan) base += "_gan";
            return [`${base}_1.mp3`, `${base}_2.mp3`, `${base}_3.mp3`, `${base}_4.mp3`];
        }
      }
    };

    const categorySelect = document.getElementById("category");
    const optionsContainer = document.getElementById("options-container");
    const playerDiv = document.getElementById("player");
    const template = document.getElementById("audio-template");

    // Populate categories
    Object.keys(categories).forEach(cat => {
      categorySelect.innerHTML += `<option value="${cat}">${cat}</option>`;
    });

    // ----- Render category-specific options -----
    function renderOptions(categoryName) {
      const { options } = categories[categoryName];
      optionsContainer.innerHTML = "";

      options.forEach(opt => {
        if (opt.type === "checkbox") {
          const label = document.createElement("label");
          const checkbox = document.createElement("input");
          checkbox.type = "checkbox";
          checkbox.id = opt.id;
          label.append(checkbox, " ", opt.label);
          optionsContainer.append(label);
          checkbox.addEventListener("change", loadAudioPlayers);
        }

        else if (opt.type === "radio-group") {
          const groupDiv = document.createElement("div");
          groupDiv.className = "radio-group";
          const groupLabel = document.createElement("p");
          groupLabel.textContent = opt.label;
          groupDiv.append(groupLabel);

          opt.values.forEach((val, i) => {
            const radio = document.createElement("input");
            radio.type = "radio";
            radio.name = opt.id;
            radio.value = val;
            radio.id = `${opt.id}-${val}`;
            const lbl = document.createElement("label");
            lbl.htmlFor = radio.id;
            lbl.textContent = val;
            groupDiv.append(radio, lbl);
            if (i === 0) radio.checked = true; // default
            radio.addEventListener("change", loadAudioPlayers);
          });
          optionsContainer.append(groupDiv);
        }
      });

      loadAudioPlayers(); // auto-load default config
    }

    // ----- Generate audio players -----
    function loadAudioPlayers() {
      const cat = categorySelect.value;
      if (!cat) return;
      const { options, getFiles } = categories[cat];

      const selections = {};
      options.forEach(opt => {
        if (opt.type === "checkbox") {
          selections[opt.id] = document.getElementById(opt.id)?.checked || false;
        } else if (opt.type === "radio-group") {
          const checked = document.querySelector(`input[name="${opt.id}"]:checked`);
          selections[opt.id] = checked ? checked.value : opt.values?.[0];
        }
      });

      const files = getFiles(selections);
      playerDiv.innerHTML = "";

      files.forEach((file, i) => {
        const clone = template.content.cloneNode(true);
        clone.querySelector(".audio-title").textContent = `Example ${i + 1}`;
        clone.querySelector("source").src = file;
        playerDiv.appendChild(clone);
      });
    }

    // ----- Initialize -----
    const defaultCategory = "Waveform encoder (baseline)";
    window.addEventListener("DOMContentLoaded", () => {
      categorySelect.value = defaultCategory;
      renderOptions(defaultCategory);
      loadAudioPlayers();
    });

    categorySelect.addEventListener("change", e => {
      renderOptions(e.target.value);
    });
  </script>
</body>

</html>

